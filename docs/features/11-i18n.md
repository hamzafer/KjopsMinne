# Feature 11: Internationalization (i18n)

## Status: Implemented

Multi-language support for the frontend application.

## Overview

The application supports two languages:
- **Norwegian (nb)** - Default language
- **English (en)** - Secondary language

Users can switch languages via the UI, and the selection persists across sessions.

## Implementation

### Framework: next-intl

We use [next-intl](https://next-intl-docs.vercel.app/) for internationalization, which integrates seamlessly with Next.js App Router.

### File Structure

```
frontend/src/
├── i18n/
│   ├── routing.ts        # Locale configuration
│   └── request.ts        # Server-side locale handling
├── messages/
│   ├── nb.json           # Norwegian translations
│   └── en.json           # English translations
├── middleware.ts         # Locale detection & redirects
└── app/
    └── [locale]/         # Locale-prefixed routes
        ├── layout.tsx    # NextIntlClientProvider setup
        ├── page.tsx      # Dashboard
        ├── upload/
        ├── receipts/
        └── analytics/
```

### Routing Configuration

```typescript
// frontend/src/i18n/routing.ts
import { defineRouting } from "next-intl/routing";

export const routing = defineRouting({
  locales: ["nb", "en"],
  defaultLocale: "nb",
  localePrefix: "always",  // URLs always include locale
});

export type Locale = (typeof routing.locales)[number];
```

### URL Structure

| URL | Description |
|-----|-------------|
| `/` | Redirects to `/nb` |
| `/nb` | Norwegian dashboard |
| `/nb/upload` | Norwegian upload page |
| `/en` | English dashboard |
| `/en/analytics` | English analytics page |

### Middleware

```typescript
// frontend/src/middleware.ts
import createMiddleware from "next-intl/middleware";
import { routing } from "./i18n/routing";

export default createMiddleware(routing);

export const config = {
  matcher: ["/((?!api|_next|.*\\..*).*)"],
};
```

The middleware:
1. Detects user's preferred language from browser
2. Redirects `/` to `/nb` (default locale)
3. Sets locale cookie for persistence

### Translation Files

**Norwegian (nb.json)**:
```json
{
  "Navigation": {
    "dashboard": "Oversikt",
    "upload": "Last opp",
    "receipts": "Kvitteringer",
    "analytics": "Analyse"
  },
  "Dashboard": {
    "greeting": "God dag",
    "totalSpending": "Totalt forbruk"
  }
}
```

**English (en.json)**:
```json
{
  "Navigation": {
    "dashboard": "Dashboard",
    "upload": "Upload",
    "receipts": "Receipts",
    "analytics": "Analytics"
  },
  "Dashboard": {
    "greeting": "Good day",
    "totalSpending": "Total spending"
  }
}
```

### Using Translations in Components

```tsx
// Server Component
import { getTranslations } from "next-intl/server";

export default async function Dashboard() {
  const t = await getTranslations("Dashboard");
  return <h1>{t("greeting")}</h1>;
}

// Client Component
"use client";
import { useTranslations } from "next-intl";

export function Navigation() {
  const t = useTranslations("Navigation");
  return <nav>{t("dashboard")}</nav>;
}
```

### Language Switcher

```tsx
// frontend/src/components/LanguageSwitcher.tsx
"use client";
import { useLocale } from "next-intl";
import { useRouter, usePathname } from "next/navigation";

export function LanguageSwitcher() {
  const locale = useLocale();
  const router = useRouter();
  const pathname = usePathname();

  const switchLocale = (newLocale: string) => {
    const newPath = pathname.replace(`/${locale}`, `/${newLocale}`);
    router.push(newPath);
  };

  return (
    <button onClick={() => switchLocale(locale === "nb" ? "en" : "nb")}>
      {locale === "nb" ? "EN" : "NO"}
    </button>
  );
}
```

## Translation Namespaces

| Namespace | Description |
|-----------|-------------|
| `Metadata` | Page titles, descriptions |
| `Navigation` | Nav links, app name |
| `Dashboard` | Dashboard page content |
| `EmptyState` | Empty state messages |
| `Upload` | Upload page, tips, errors |
| `Receipts` | Receipt list, search |
| `ReceiptDetail` | Single receipt view |
| `Analytics` | Analytics page content |
| `Common` | Shared (currency, dates) |

## Adding New Translations

1. Add keys to both `nb.json` and `en.json`:
   ```json
   {
     "NewFeature": {
       "title": "Norwegian title",
       "description": "Norwegian description"
     }
   }
   ```

2. Use in component:
   ```tsx
   const t = useTranslations("NewFeature");
   return <h1>{t("title")}</h1>;
   ```

3. TypeScript will warn if keys are missing in either file.

## Date & Number Formatting

```tsx
import { useFormatter } from "next-intl";

function PriceDisplay({ amount }: { amount: number }) {
  const format = useFormatter();

  return (
    <span>
      {format.number(amount, { style: "currency", currency: "NOK" })}
    </span>
  );
}
```

**Note**: Currency is always NOK regardless of language.

## Future Enhancements

- [ ] Add more languages (Swedish, Danish)
- [ ] Backend error message translation
- [ ] Category name translations
- [ ] Date format localization (dd.mm.yyyy vs mm/dd/yyyy)
- [ ] RTL support (if needed)

## Related Documentation

- [next-intl docs](https://next-intl-docs.vercel.app/)
- [Frontend Structure](../../CLAUDE.md#frontend-structure)
